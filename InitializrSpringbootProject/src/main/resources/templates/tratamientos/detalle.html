<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layouts/layout}">
<head>
    <title th:text="${tratamiento.nombre} + ' - KVestética'">Tratamiento - KVestética</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><!-- comment -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div layout:fragment="content">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
                <li class="breadcrumb-item"><a th:href="@{/tratamientos}">Tratamientos</a></li>
                <li class="breadcrumb-item active" th:text="${tratamiento.nombre}"></li>
            </ol>
        </nav>

        <div class="row">
            <!-- Información Principal del Tratamiento -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header bg-color2 text-white">
                        <h2 class="h4 mb-0" th:text="${tratamiento.nombre}"></h2>
                    </div>
                    <div class="card-body">
                        <!-- Descripción -->
                        <div class="mb-4">
                            <h4 class="text-color2 mb-3">
                                <i class="fas fa-info-circle me-2"></i>Descripción del Tratamiento
                            </h4>
                            <p class="lead text-muted" th:text="${tratamiento.descripcion}"></p>
                        </div>

                        <!-- Detalles Técnicos -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card bg-color5 border-0">
                                    <div class="card-body text-center">
                                        <i class="fas fa-clock fa-2x text-color1 mb-2"></i>
                                        <h5 class="fw-bold text-color2">Duración</h5>
                                        <p class="h4 text-color1 mb-0" th:text="${tratamiento.duracionMinutos} + ' min'"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-color5 border-0">
                                    <div class="card-body text-center">
                                        <i class="fas fa-tag fa-2x text-color1 mb-2"></i>
                                        <h5 class="fw-bold text-color2">Precio</h5>
                                        <p class="h4 text-color1 mb-0" 
                                           th:text="'$' + ${#numbers.formatDecimal(tratamiento.precio, 1, 2)}"></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Categoría -->
                        <div class="mb-4">
                            <h5 class="fw-bold text-color2 mb-2">
                                <i class="fas fa-folder me-2"></i>Categoría
                            </h5>
                            <span class="badge bg-color4 fs-6" th:text="${tratamiento.categoria.nombre}"></span>
                        </div>

                        <!-- Código del Tratamiento -->
                        <div class="mb-4">
                            <h5 class="fw-bold text-color2 mb-2">
                                <i class="fas fa-barcode me-2"></i>Código del Tratamiento
                            </h5>
                            <p class="text-muted" th:text="${tratamiento.codigoTratamiento}"></p>
                        </div>
                    </div>
                </div>

                <!-- Beneficios -->
                <div class="card mb-4">
                    <div class="card-header bg-color4 text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-star me-2"></i>Beneficios del Tratamiento
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle text-success me-3 fa-lg"></i>
                                    <span>Resultados visibles desde la primera sesión</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle text-success me-3 fa-lg"></i>
                                    <span>Tecnología de última generación</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle text-success me-3 fa-lg"></i>
                                    <span>Personal especializado</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle text-success me-3 fa-lg"></i>
                                    <span>Ambiente seguro y esterilizado</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Procedimiento -->
                <div class="card mb-4">
                    <div class="card-header bg-color1 text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-list-ol me-2"></i>¿Qué incluye el tratamiento?
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3 text-center">
                                <div class="bg-color5 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" 
                                     style="width: 80px; height: 80px;">
                                    <i class="fas fa-hand-sparkles fa-2x text-color1"></i>
                                </div>
                                <h6 class="fw-bold text-color2">Limpieza Profunda</h6>
                                <small class="text-muted">Preparación de la zona</small>
                            </div>
                            <div class="col-md-4 mb-3 text-center">
                                <div class="bg-color5 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" 
                                     style="width: 80px; height: 80px;">
                                    <i class="fas fa-spa fa-2x text-color1"></i>
                                </div>
                                <h6 class="fw-bold text-color2">Aplicación</h6>
                                <small class="text-muted">Técnica especializada</small>
                            </div>
                            <div class="col-md-4 mb-3 text-center">
                                <div class="bg-color5 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" 
                                     style="width: 80px; height: 80px;">
                                    <i class="fas fa-shield-alt fa-2x text-color1"></i>
                                </div>
                                <h6 class="fw-bold text-color2">Protección</h6>
                                <small class="text-muted">Cuidados posteriores</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar - Acciones y Información -->
            <div class="col-lg-4">
                <!-- Card de Acción -->
                <div class="card mb-4 sticky-top" style="top: 20px;">
                    <div class="card-header bg-color2 text-white text-center">
                        <h4 class="mb-0">
                            <i class="fas fa-calendar-plus me-2"></i>Agendar Cita
                        </h4>
                    </div>
                    <div class="card-body text-center">
                        <div class="mb-4">
                            <span class="h2 text-color1 fw-bold" 
                                  th:text="'$' + ${#numbers.formatDecimal(tratamiento.precio, 1, 2)}"></span>
                            <span class="text-muted"> por sesión</span>
                        </div>
                        
                        <div class="mb-3">
                            <i class="fas fa-clock text-color1 me-2"></i>
                            <span th:text="${tratamiento.duracionMinutos} + ' minutos aprox.'"></span>
                        </div>
                        
                        <div class="d-grid gap-2 mb-3">
                            <a th:href="@{/citas/nueva(tratamientoId=${tratamiento.id})}" 
                               class="btn btn-primary btn-lg">
                                <i class="fas fa-calendar-check me-2"></i>Agendar Ahora
                            </a>
                            <button class="btn btn-outline-primary"
                                    th:onclick="|agregarTratamientoAlCarrito(${tratamiento.id})|">
                                <i class="fas fa-cart-plus me-2"></i>Agregar al Carrito
                            </button>
                        </div>
                        
                        <div class="small text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Cancelación gratuita hasta 24h antes
                        </div>
                    </div>
                </div>

                <!-- Información de Contacto -->
                <div class="card mb-4">
                    <div class="card-header bg-color4 text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-phone me-2"></i>¿Necesitas ayuda?
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="small text-muted mb-3">
                            Nuestros especialistas están disponibles para resolver tus dudas sobre este tratamiento.
                        </p>
                        <div class="d-grid gap-2">
                            <a th:href="@{/contacto}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-envelope me-2"></i>Contactar
                            </a>
                            <a href="tel:+1234567890" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-phone me-2"></i>Llamar Ahora
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Tratamientos Relacionados -->
                <div class="card">
                    <div class="card-header bg-color1 text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-spa me-2"></i>Tratamientos Relacionados
                        </h5>
                    </div>
                    <div class="card-body">
                        <div th:each="tratamientoRel : ${tratamientosRelacionados}" 
                             class="mb-3 pb-3 border-bottom">
                            <h6 class="fw-bold text-color2" th:text="${tratamientoRel.nombre}"></h6>
                            <p class="small text-muted mb-2" 
                               th:text="${#strings.abbreviate(tratamientoRel.descripcion, 80)}"></p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-color4" 
                                      th:text="${tratamientoRel.duracionMinutos} + ' min'"></span>
                                <a th:href="@{/tratamientos/{id}(id=${tratamientoRel.id})}" 
                                   class="btn btn-outline-primary btn-sm">
                                    Ver Más
                                </a>
                            </div>
                        </div>
                        <div th:if="${tratamientosRelacionados.empty}" class="text-center">
                            <p class="small text-muted mb-0">
                                No hay tratamientos relacionados disponibles
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="card mt-4">
            <div class="card-header bg-color2 text-white">
                <h4 class="mb-0">
                    <i class="fas fa-question-circle me-2"></i>Preguntas Frecuentes
                </h4>
            </div>
            <div class="card-body">
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                ¿Cuántas sesiones son necesarias?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                El número de sesiones varía según el tratamiento y las características individuales. Nuestros especialistas evaluarán tu caso y te recomendarán el plan más adecuado durante la primera consulta.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                ¿Hay algún cuidado posterior?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Sí, después de cada sesión te proporcionaremos instrucciones específicas para el cuidado posterior que garantizarán los mejores resultados y minimizarán cualquier molestia.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                ¿Puedo cancelar o reprogramar mi cita?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Sí, puedes cancelar o reprogramar tu cita sin costo hasta 24 horas antes de la hora programada. Después de ese tiempo, podría aplicarse un cargo por cancelación.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div layout:fragment="scripts">
        <script>
            function agregarTratamientoAlCarrito(tratamientoId) {
                // Para agregar un tratamiento al carrito, primero necesitamos crear una cita
                // Redirigimos al formulario de cita con el tratamiento pre-seleccionado
                window.location.href = '/citas/nueva?tratamientoId=' + tratamientoId;
            }

            // Smooth scroll para las secciones
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        </script>

        <style>
            .sticky-top {
                position: -webkit-sticky;
                position: sticky;
                z-index: 1020;
            }
            
            .accordion-button:not(.collapsed) {
                background-color: var(--color5);
                color: var(--color2);
                border-color: var(--color1);
            }
            
            .accordion-button:focus {
                box-shadow: 0 0 0 0.2rem rgba(157, 107, 108, 0.25);
                border-color: var(--color1);
            }
        </style>
    </div>
</body>
</html>