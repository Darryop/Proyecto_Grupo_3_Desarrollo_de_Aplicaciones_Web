<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${tratamiento.nombre} + ' - KV Estética'">Detalle Tratamiento - KV Estética</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <main class="main-content">
        <div class="container">
            <!-- Mensajes flash -->
            <div th:if="${mensaje}" class="flash-message flash-success" th:text="${mensaje}"></div>
            <div th:if="${error}" class="flash-message flash-error" th:text="${error}"></div>

            <div th:if="${tratamiento}" class="treatment-detail">
                <div class="treatment-detail-grid">
                    <div class="treatment-info">
                        <h1 th:text="${tratamiento.nombre}"></h1>
                        <p class="treatment-category" th:text="'Categoría: ' + ${tratamiento.categoria.nombre}"></p>
                        <p class="treatment-description" th:text="${tratamiento.descripcion}"></p>
                        <p class="treatment-price" th:text="'$' + ${#numbers.formatDecimal(tratamiento.precio, 1, 2)}"></p>
                        <p class="treatment-duration" th:text="'Duración: ' + ${tratamiento.duracionMinutos} + ' minutos'"></p>

                        <div class="treatment-actions">
                            <a th:href="@{/citas/nueva}" class="btn btn-primary btn-large">Agendar Cita</a>
                            <a th:href="@{/tratamientos}" class="btn btn-outline">Volver a Tratamientos</a>
                        </div>
                    </div>
                </div>

                <!-- Reseñas del tratamiento -->
                <div class="reviews-section">
                    <h2>Reseñas</h2>
                    <div th:if="${reseñas and not reseñas.empty}">
                        <div th:each="resena : ${reseñas}" class="review-card">
                            <div class="review-header">
                                <span class="review-author" th:text="${resena.usuario.nombre}"></span>
                                <span class="review-rating">
                                    <span th:each="i : ${#numbers.sequence(1, 5)}">
                                        <span th:if="${i <= resena.calificacion}">★</span>
                                        <span th:if="${i > resena.calificacion}">☆</span>
                                    </span>
                                </span>
                            </div>
                            <p class="review-comment" th:text="${resena.comentario}"></p>
                            <small class="review-date" th:text="${#temporals.format(resena.fechaCreacion, 'dd/MM/yyyy')}"></small>
                        </div>
                    </div>
                    <div th:if="${!reseñas or reseñas.empty}" class="no-reviews">
                        <p>Este tratamiento aún no tiene reseñas.</p>
                    </div>
                </div>
            </div>

            <div th:unless="${tratamiento}" class="error-message">
                <h2>Tratamiento no encontrado</h2>
                <p>El tratamiento que buscas no está disponible.</p>
                <a th:href="@{/tratamientos}" class="btn btn-primary">Volver a Tratamientos</a>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>