<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${producto.nombre} + ' - KV Estética'">Detalle Producto - KV Estética</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <main class="main-content">
        <div class="container">
            <!-- Mensajes flash -->
            <div th:if="${mensaje}" class="flash-message flash-success" th:text="${mensaje}"></div>
            <div th:if="${error}" class="flash-message flash-error" th:text="${error}"></div>

            <div th:if="${producto}" class="product-detail">
                <div class="product-detail-grid">
                    <div class="product-image">
                        <img th:src="${producto.imagenUrl}" th:alt="${producto.nombre}" class="detail-img">
                    </div>
                    <div class="product-info">
                        <h1 th:text="${producto.nombre}"></h1>
                        <p class="product-category" th:text="'Categoría: ' + ${producto.categoria.nombre}"></p>
                        <p class="product-description" th:text="${producto.descripcion}"></p>
                        <p class="product-price" th:text="'$' + ${#numbers.formatDecimal(producto.precio, 1, 2)}"></p>
                        
                        <div class="stock-info">
                            <p th:if="${producto.stock > 0}" 
                               th:text="'En stock: ' + ${producto.stock} + ' unidades'" 
                               class="in-stock"></p>
                            <p th:if="${producto.stock <= 0}" class="out-of-stock">Producto agotado</p>
                        </div>

                        <div class="product-actions">
                            <form th:action="@{/carrito/agregar/producto/{id}(id=${producto.id})}" method="post" class="add-to-cart-form">
                                <div class="quantity-selector">
                                    <label for="cantidad">Cantidad:</label>
                                    <input type="number" id="cantidad" name="cantidad" value="1" min="1" 
                                           th:max="${producto.stock}" class="form-control quantity-input">
                                </div>
                                <button type="submit" class="btn btn-primary btn-large" 
                                        th:disabled="${producto.stock <= 0}">
                                    Agregar al Carrito
                                </button>
                            </form>
                            <a th:href="@{/productos}" class="btn btn-outline">Volver a Productos</a>
                        </div>
                    </div>
                </div>

                <!-- Reseñas del producto -->
                <div class="reviews-section">
                    <h2>Reseñas</h2>
                    <div th:if="${reseñas and not reseñas.empty}">
                        <div th:each="resena : ${reseñas}" class="review-card">
                            <div class="review-header">
                                <span class="review-author" th:text="${resena.usuario.nombre}"></span>
                                <span class="review-rating">
                                    <span th:each="i : ${#numbers.sequence(1, 5)}">
                                        <span th:if="${i <= resena.calificacion}">★</span>
                                        <span th:if="${i > resena.calificacion}">☆</span>
                                    </span>
                                </span>
                            </div>
                            <p class="review-comment" th:text="${resena.comentario}"></p>
                            <small class="review-date" th:text="${#temporals.format(resena.fechaCreacion, 'dd/MM/yyyy')}"></small>
                        </div>
                    </div>
                    <div th:if="${!reseñas or reseñas.empty}" class="no-reviews">
                        <p>Este producto aún no tiene reseñas.</p>
                    </div>
                </div>
            </div>

            <div th:unless="${producto}" class="error-message">
                <h2>Producto no encontrado</h2>
                <p>El producto que buscas no está disponible.</p>
                <a th:href="@{/productos}" class="btn btn-primary">Volver a Productos</a>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>