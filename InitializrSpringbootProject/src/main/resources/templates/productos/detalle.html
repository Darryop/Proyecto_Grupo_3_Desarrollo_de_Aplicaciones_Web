<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="~{fragments/header :: head}">
        <title th:text="${producto.nombre} + ' | KWestética'">Producto | KWestética</title>
    </th:block>
</head>
<body>
    <th:block th:insert="~{fragments/header :: body}">
        <div class="container py-5">
            <div class="row">
                <div class="col-md-6">
                    <img th:src="${producto.imagenUrl}" class="img-fluid rounded" alt="Producto">
                </div>
                <div class="col-md-6">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a th:href="@{/}">Inicio</a></li>
                            <li class="breadcrumb-item"><a th:href="@{/productos}">Productos</a></li>
                            <li class="breadcrumb-item active" th:text="${producto.nombre}"></li>
                        </ol>
                    </nav>
                    
                    <h1 th:text="${producto.nombre}" style="color: var(--color-logo);"></h1>
                    <p class="text-muted" th:text="${producto.categoria.nombre}"></p>
                    
                    <div class="my-4">
                        <h2 class="price" th:text="'$' + ${#numbers.formatDecimal(producto.precio, 1, 2)}"></h2>
                        <p th:if="${producto.stock > 0}" class="text-success">
                            <i class="bi bi-check-circle"></i> En stock: <span th:text="${producto.stock}"></span> unidades
                        </p>
                        <p th:unless="${producto.stock > 0}" class="text-danger">
                            <i class="bi bi-x-circle"></i> Agotado
                        </p>
                    </div>
                    
                    <div class="mb-4">
                        <h5>Descripción</h5>
                        <p th:text="${producto.descripcion}"></p>
                    </div>
                    
                    <div th:if="${producto.stock > 0}" class="d-flex gap-3">
                        <div class="input-group" style="width: 150px;">
                            <button class="btn btn-outline-secondary" type="button" onclick="decrementQuantity()">-</button>
                            <input type="number" id="quantity" class="form-control text-center" value="1" min="1" th:max="${producto.stock}">
                            <button class="btn btn-outline-secondary" type="button" onclick="incrementQuantity()">+</button>
                        </div>
                        <button class="btn btn-primary flex-grow-1" onclick="addToCart()">
                            <i class="bi bi-cart-plus"></i> Agregar al Carrito
                        </button>
                    </div>
                    
                    <div th:unless="${producto.stock > 0}">
                        <button class="btn btn-secondary" disabled>
                            <i class="bi bi-cart-x"></i> Producto Agotado
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function incrementQuantity() {
                const input = document.getElementById('quantity');
                const max = parseInt(input.getAttribute('max'));
                if (parseInt(input.value) < max) {
                    input.value = parseInt(input.value) + 1;
                }
            }

            function decrementQuantity() {
                const input = document.getElementById('quantity');
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                }
            }

            function addToCart() {
                const quantity = document.getElementById('quantity').value;
                const productId = [[${producto.id}]];
                
                fetch(`/carrito/agregar/producto/${productId}?cantidad=${quantity}`, {
                    method: 'POST'
                }).then(response => {
                    if (response.ok) {
                        alert('Producto agregado al carrito');
                        updateCartCount();
                    } else {
                        alert('Error al agregar al carrito');
                    }
                }).catch(error => {
                    console.error('Error:', error);
                });
            }
        </script>
    </th:block>
</body>
</html>